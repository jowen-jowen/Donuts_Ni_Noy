<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Verify OTP</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='OTPVerif.css') }}">
</head>
<body>
<div class="box">
    <h2>OTP Verification</h2>
    <p>We sent a code to <b>{{ email }}</b></p>
    {% if error %}
        <p>{{ error }}</p>
    {% endif %}
    <form id="otpForm">
        <input type="text" name="otp" maxlength="6" placeholder="Enter OTP" required>
        <button type="submit">Verify</button>
    </form>
</div>

<script>
document.getElementById("otpForm").addEventListener("submit", function(e) {
    e.preventDefault();
    let formData = new FormData(this);

    fetch("{{ url_for('verify_otp') }}", {
        method: "POST",
        body: formData
    })
    .then(res => res.json())
    .then(data => {
        if (data.success) {
            showPopup("Wait for Approval");
            setTimeout(() => {
                window.location.href = "/login";
            }, 2000);
        } else {
            showPopup(data.message, true);
        }
    })
});

function showPopup(message, error = false) {
    const popup = document.createElement("div");
    popup.textContent = message;
    popup.style.position = "fixed";
    popup.style.top = "50%";
    popup.style.left = "50%";
    popup.style.transform = "translate(-50%, -50%)";
    popup.style.padding = "30px 60px";
    popup.style.fontSize = "30px";
    popup.style.borderRadius = "20px";
    popup.style.zIndex = "9999";
    popup.style.color = "white";
    popup.style.background = error ? "#ff4d4d" : "#1ec94c";
    popup.style.boxShadow = "0 6px 20px rgba(0,0,0,0.3)";
    popup.style.opacity = "0";
    popup.style.transition = "opacity 0.4s ease-in-out";

    document.body.appendChild(popup);

    setTimeout(() => popup.style.opacity = "1", 50);
    setTimeout(() => {
        popup.style.opacity = "0";
        setTimeout(() => popup.remove(), 400);
    }, 1500);
}
</script>
</body>
</html>
